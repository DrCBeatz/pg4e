
create table xy_raw(x text, y text, y_id integer);
create table y (id serial, primary key(id), y text);
create table xy(id serial, primary key(id), x text, y_id integer, UNIQUE(x,y_id));

copy xy_raw(x,y) FROM stdin DELIMITER ',' CSV;
Zap,A
Zip,A
One,B
Zap,B
\.

-- Or

INSERT INTO xy_raw (x, y) VALUES
('Zap', 'A'), ('Zip', 'A'), ('One', 'B'), ('Zap', 'B');


select distinct y from xy_raw;

\d xy_raw
\d+ y

insert into y (y) select distinct y from xy_raw;

update xy_raw set y_id = (SELECT y.id FROM y where y.y = xy_raw.y);

select * from xy_raw;

insert into xy (x, y_id) select x, y_id from xy_raw;

select * from xy join y on xy.y_id = y.id;

ALTER TABLE xy_raw DROP COLUMN y;

drop table xy_raw;

